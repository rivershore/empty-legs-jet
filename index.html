<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empty Leg Private Jet Deals | 50-75% Off Charter Flights</title>
    <meta name="description" content="Live empty leg private jet flights at 50-75% discount. Real-time availability, instant booking. Luxury travel for less.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a365d;
            --secondary: #2d3748;
            --accent: #d4af37;
            --light: #f7fafc;
            --dark: #2d3748;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent);
        }
        
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 3rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
        }
        
        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 10px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            background: white;
            cursor: pointer;
        }
        
        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
        }
        
        .flight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .flight-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .flight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .flight-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .flight-price {
            background: var(--accent);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .flight-body {
            padding: 1.5rem;
        }
        
        .flight-route {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .origin, .destination {
            text-align: center;
        }
        
        .origin i, .destination i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .flight-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .book-btn {
            display: block;
            width: 100%;
            background: var(--primary);
            color: white;
            text-align: center;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
        }
        
        footer {
            background: var(--primary);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .flight-grid {
                grid-template-columns: 1fr;
            }
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-plane"></i> EmptyLeg Deals
                </div>
                <div id="status">Loading flights...</div>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Luxury Empty Leg Private Jet Flights</h1>
            <p>Save 50-75% on private jet charters • Live availability • Instant booking</p>
        </div>
    </section>

    <main class="container">
        <div class="controls">
            <div class="search-box">
                <input type="text" id="search" placeholder="Search flights...">
            </div>
            <div class="filters">
                <select id="priceFilter">
                    <option value="">All Prices</option>
                    <option value="5000">Under $5,000</option>
                    <option value="10000">Under $10,000</option>
                </select>
                <button id="refresh" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <div class="flight-grid" id="flights">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading available flights...</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>© 2024 Empty Leg Deals • All flights via Villiers • Affiliate commissions may be earned</p>
            <p id="updateTime">Last updated: --:--</p>
        </div>
    </footer>

   // REPLACE the entire <script> section in your HTML with this:

<script>
    let allFlights = [];
    
    async function loadFlights() {
        try {
            showLoading();
            
            // Try to fetch real data first
            await fetchRealFlights();
            
        } catch (error) {
            console.log('Using sample data as fallback');
            showSampleData();
        }
    }
    
    function showLoading() {
        document.getElementById('flightGrid').innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading available empty leg flights...</p>
            </div>
        `;
    }
    
    async function fetchRealFlights() {
        try {
            const rssUrl = 'https://api.villiers.ai/feeds/empty-legs?id=7907';
            
            // Using a reliable CORS proxy
            const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(rssUrl);
            
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error('Network response failed');
            
            const data = await response.json();
            const xmlText = data.contents;
            
            // Parse the XML
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            
            // Check for errors
            if (xmlDoc.querySelector('parsererror')) {
                throw new Error('XML parsing error');
            }
            
            // Extract flights from RSS
            const items = xmlDoc.querySelectorAll('item');
            const flights = [];
            
            items.forEach(item => {
                try {
                    // Helper function to get namespaced values
                    const getNamespacedValue = (localName) => {
                        // Try different ways to access namespaced elements
                        const element = item.querySelector(`[local-name()="${localName}"]`) || 
                                        item.querySelector(`villiers\\:${localName}`) ||
                                        item.querySelector(localName);
                        return element ? element.textContent.trim() : '';
                    };
                    
                    // Get the regular link
                    const linkElement = item.querySelector('link');
                    const baseLink = linkElement ? linkElement.textContent.trim() : 'https://villiers.ai/empty-legs';
                    
                    // Ensure affiliate ID is in URL
                    let affiliateLink = baseLink;
                    if (!affiliateLink.includes('id=7907') && !affiliateLink.includes('ref=7907')) {
                        affiliateLink += (affiliateLink.includes('?') ? '&' : '?') + 'id=7907';
                    }
                    
                    const flight = {
                        timestamp: new Date().toISOString(),
                        aircraft: getNamespacedValue('aircraftType') || 'Private Jet',
                        origin: getNamespacedValue('originAirport') || '',
                        destination: getNamespacedValue('destinationAirport') || '',
                        date: getNamespacedValue('departureDate') || '',
                        price: getNamespacedValue('price') || 'Price on request',
                        seats: getNamespacedValue('seatsAvailable') || '',
                        duration: getNamespacedValue('flightDuration') || 'Direct',
                        link: affiliateLink
                    };
                    
                    // Only add if we have basic data
                    if (flight.aircraft && flight.origin && flight.destination) {
                        flights.push(flight);
                    }
                } catch (itemError) {
                    console.log('Error parsing flight item:', itemError);
                }
            });
            
            if (flights.length > 0) {
                allFlights = flights;
                displayFlights(flights);
                updateStatus(`Live: ${flights.length} flights available`, true);
                return true;
            } else {
                throw new Error('No valid flights found in RSS');
            }
            
        } catch (error) {
            console.log('Real data fetch failed:', error);
            return false;
        }
    }
    
    function showSampleData() {
        const sampleFlights = [
            {
                timestamp: new Date().toISOString(),
                aircraft: "Gulfstream G650",
                origin: "Teterboro, NJ (KTEB)",
                destination: "Miami, FL (KMIA)",
                date: "March 15, 2024",
                price: "$12,500",
                seats: "8",
                duration: "2h 45m",
                link: "https://villiers.ai/empty-legs?id=7907"
            },
            {
                timestamp: new Date().toISOString(),
                aircraft: "Citation XLS",
                origin: "London Biggin Hill (EGKB)",
                destination: "Paris Le Bourget (LFPB)",
                date: "March 18, 2024",
                price: "£8,900",
                seats: "6",
                duration: "1h 15m",
                link: "https://villiers.ai/empty-legs?id=7907"
            },
            {
                timestamp: new Date().toISOString(),
                aircraft: "Bombardier Global 6000",
                origin: "Los Angeles, CA (KLAX)",
                destination: "New York, NY (KJFK)",
                date: "March 20, 2024",
                price: "$18,750",
                seats: "12",
                duration: "5h 30m",
                link: "https://villiers.ai/empty-legs?id=7907"
            }
        ];
        
        allFlights = sampleFlights;
        displayFlights(sampleFlights);
        updateStatus(`Demo: ${sampleFlights.length} sample flights`, false);
    }
    
    function updateStatus(message, isLive) {
        const time = new Date().toLocaleTimeString();
        const statusEl = document.getElementById('lastUpdated');
        
        if (isLive) {
            statusEl.innerHTML = `
                <i class="fas fa-check-circle" style="color: #38a169;"></i> 
                <span>${message} • Updated ${time}</span>
            `;
        } else {
            statusEl.innerHTML = `
                <i class="fas fa-info-circle" style="color: #d4af37;"></i> 
                <span>${message} • Last checked ${time}</span>
            `;
        }
        
        document.getElementById('updateTime').textContent = `Last updated: ${time}`;
    }
    
    function displayFlights(flights) {
        const flightGrid = document.getElementById('flightGrid');
        
        if (!flights || flights.length === 0) {
            flightGrid.innerHTML = `
                <div class="loading">
                    <i class="fas fa-plane-slash" style="font-size: 2rem; color: #718096;"></i>
                    <p>No flights available at the moment. Check back soon!</p>
                </div>
            `;
            return;
        }
        
        flightGrid.innerHTML = flights.map(flight => `
            <div class="flight-card">
                <div class="flight-header">
                    <div class="flight-aircraft">
                        <i class="fas fa-jet-fighter-up"></i> ${flight.aircraft}
                    </div>
                    <div class="flight-price">${flight.price}</div>
                </div>
                <div class="flight-body">
                    <div class="flight-route">
                        <div class="origin">
                            <i class="fas fa-plane-departure"></i>
                            <h3>${flight.origin}</h3>
                            <p>Departure</p>
                        </div>
                        <div class="flight-duration">
                            <i class="fas fa-clock"></i>
                            <p>${flight.duration}</p>
                        </div>
                        <div class="destination">
                            <i class="fas fa-plane-arrival"></i>
                            <h3>${flight.destination}</h3>
                            <p>Arrival</p>
                        </div>
                    </div>
                    
                    <div class="flight-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span><strong>Date:</strong> ${flight.date || 'Flexible'}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <span><strong>Seats:</strong> ${flight.seats || 'N/A'} available</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-clock"></i>
                            <span><strong>Type:</strong> Empty Leg</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-percentage"></i>
                            <span><strong>Save:</strong> 50-75%</span>
                        </div>
                    </div>
                    
                    <a href="${flight.link}" target="_blank" class="book-button" rel="noopener noreferrer">
                        <i class="fas fa-shopping-cart"></i> Book Now & Save
                    </a>
                </div>
            </div>
        `).join('');
    }
    
    function filterFlights() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const maxPrice = document.getElementById('priceFilter').value;
        const minSeats = document.getElementById('seatsFilter').value;
        
        const filtered = allFlights.filter(flight => {
            // Search term filter
            const matchesSearch = !searchTerm || 
                flight.aircraft.toLowerCase().includes(searchTerm) ||
                flight.origin.toLowerCase().includes(searchTerm) ||
                flight.destination.toLowerCase().includes(searchTerm) ||
                flight.price.toLowerCase().includes(searchTerm);
            
            // Price filter
            let matchesPrice = true;
            if (maxPrice && flight.price) {
                const priceNum = extractNumber(flight.price);
                if (!isNaN(priceNum)) {
                    matchesPrice = priceNum <= parseInt(maxPrice);
                }
            }
            
            // Seats filter
            let matchesSeats = true;
            if (minSeats && flight.seats) {
                const seatsNum = extractNumber(flight.seats);
                if (!isNaN(seatsNum)) {
                    matchesSeats = seatsNum >= parseInt(minSeats);
                }
            }
            
            return matchesSearch && matchesPrice && matchesSeats;
        });
        
        displayFlights(filtered);
    }
    
    function extractNumber(text) {
        const match = text.match(/\d+/);
        return match ? parseInt(match[0]) : NaN;
    }
    
    // Event listeners
    document.getElementById('searchInput').addEventListener('input', filterFlights);
    document.getElementById('priceFilter').addEventListener('change', filterFlights);
    document.getElementById('seatsFilter').addEventListener('change', filterFlights);
    document.getElementById('refreshBtn').addEventListener('click', async () => {
        const success = await fetchRealFlights();
        if (!success) {
            showSampleData();
        }
    });
    
    // Auto-refresh every 5 minutes
    setInterval(async () => {
        await fetchRealFlights();
    }, 300000);
    
    // Initial load
    document.addEventListener('DOMContentLoaded', loadFlights);
</script>
</body>
</html>
